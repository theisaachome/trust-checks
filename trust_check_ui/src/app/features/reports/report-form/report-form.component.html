<div class="ui segment">
  <h4 class="ui header">Form Data</h4>
  <div>{{reportForm.value | json}}</div>
  <div>Form Valid Status : {{reportForm.valid}}</div>
</div>

  <form class="ui form error"
    [formGroup]="reportForm" (ngSubmit)="onSubmit()">

    <div class="ui horizontal divider header" style="margin-top: 10px;">Scammer Details Information</div>
         <ng-container formGroupName="scammer_details">
            <div class="two fields">
              <div class="field">
                <label for="aliasName">Scammer Alias</label>
                <input
                  type="text"
                  name="aliasName"
                  placeholder="e.g., John Doe"
                  formControlName="scammer_alias"
                >
                <ng-container
                  *ngTemplateOutlet="textErrorMessage; context: { control: scammerDetails.get('scammer_alias') }">
                </ng-container>
              </div>
              <div class="field">
                <label for="fullName">Full Name</label>
                <input
                  type="text"
                  name="fullName"
                  placeholder="e.g., Jonathan Doe Market"
                  formControlName="full_name"
                >
              </div>
            </div>

           <div class="two fields" >
             <div class="field">
               <label for="phoneNumber">Phone Number</label>
               <input
                 id="phoneNumber"
                 type="text"
                 placeholder="e.g., 09250832014"
                 formControlName="phone_number"
               >
             </div>
             <div class="field">
               <label for="email">Email</label>
               <input
                 type="email"
                 id="email"
                 placeholder="johndoe@example.com"
                 formControlName="email_address"
               >
             </div>
           </div>
         </ng-container>

        <!--  scame_case_information  -->
        <h4 class="ui dividing header"> Scam Case Information</h4>
        <ng-container formGroupName="scame_case_information">
          <div class="three fields">
            <div class="field">
              <label>Select Scam Category</label>
              <select
                class="ui search dropdown"
                      formControlName="scame_category"
                      (change)="onScameCategoryChange($event)"
              >
                <option *ngFor="let category of scameCategories;" [value]="category.id">{{category.name}}</option>
              </select>
            </div>
            <div class="field">
              <label for="caseType">Select Case Type</label>
              <input
                type="text"
                id="caseType"
                formControlName="case_type"
              >
            </div>
            <div class="field">
              <label >Date of Incident</label>
              <report-datepicker (valueChange)="onDateOfIncidentPick($event)"></report-datepicker>
            </div>
          </div>
          <div class="field">
            <label for="short_story">Short Story</label>
            <input
              type="text"
              name="short_story"
              formControlName="short_story"
              placeholder="e.g., I was looking...">
          </div>
          <div class="field">
            <label for="longDescription">Long Description</label>
            <textarea
              name="description"
              id="longDescription" cols="30" rows="5"
              formControlName="long_story"
            ></textarea>
          </div>
        </ng-container>


    <!-- Payment Information  -->
    <div style="margin: 16px 0;">
      <div class="ui horizontal divider header" style="margin-top: 0;">Financial Information</div>
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <p style="margin: 0;">Did you lose money?</p>
        <button class="ui tiny icon basic button" (click)="onAddTransactions()">
          Add Transaction
        </button>
      </div>
      <small>If yes, please provide the financial information involved.</small>
    </div>
    <ng-container formGroupName="payment_information">
      <div formArrayName="transactions">
        <div *ngFor="let transaction of transactions.controls; let i = index"
             [formGroupName]="i"  class="ui segment">

          <div class="ui grid middle aligned">
            <!-- Title -->
            <div class="twelve wide column">
              <h4 class="ui horizontal divider header">
                Transaction {{ i + 1 }}
              </h4>
            </div>
            <!-- Delete button -->
            <div class="four wide right aligned column">
              <button type="button"
                      class="ui red icon mini button"
                      (click)="onRemoveTransactions(i)">
                <i class="trash icon"></i>
              </button>
            </div>
          </div>

          <div class="two fields">
            <div class="field">
              <label>Payment Method</label>
              <input
                type="text"
                placeholder="e.g., Bank Transfer / eWallet."
                formControlName="payment_method" />
            </div>
            <div class="field">
              <label>Bank Name / eWallet-Name</label>
              <input
                type="text"
                placeholder="e.g., ABC Bank, iWallet.."
                formControlName="bank_name">
            </div>
          </div>
          <div class="two fields">
            <div class="field">
              <label for="accountNumber">Account Number</label>
              <input
                type="text"
                name="accountNumber"
                placeholder="e.g., 1234567899"
                inputmode="numeric"
                pattern="\d*"
                formControlName="bank_account_number"
              >
            </div>
            <div class="field">
              <label for="accountHolderName">Account Holder Name</label>
              <input
                type="text"
                name="accountHolderName"
                placeholder="e.g., Aung Aung Tan"
                formControlName="account_holder_name"
              >
            </div>
          </div>

          <div class="two fields">
            <div class="field">
              <label for="amountLost">Amount Lost</label>
              <input type="text" placeholder="e.g., $ 1500" formControlName="amount">
            </div>
            <div class="field">
              <label for="transaction_date">Transaction Date</label>
              <input type="date" formControlName="transaction_date">
            </div>
          </div>

        </div>
      </div>
    </ng-container>



    <div class="two fields">
<!--      <div class="field">-->
<!--        <label for="file">Upload files</label>-->
<!--        <div class="ui right action left icon input">-->
<!--          <i class="folder open yellow icon"></i>-->
<!--          <input type="text" formControlName="email_address" name="fileName" placeholder="Select file" readonly>-->
<!--          <input type="file" #fileInput style="display: none;" (change)="onFileSelected($event)">-->
<!--          <button class="ui button" (click)="fileInput.click()">-->
<!--            Upload-->
<!--          </button>-->
<!--        </div>-->
<!--      </div>-->
    </div>



    <!-- Scammer Social Media -->
    <h4 class="ui horizontal dividing header">Scammer Social Media Accounts</h4>
    <p>Please share any social media accounts used by the scammer. Share Now :
      <button class="circular compact ui icon basic button " type="button" (click)="onAddSocialMediaHandles()">
        <i class="icon add"></i>
      </button>
    </p>
    <ng-container formArrayName="social_media_handles">
      <div class="ui fluid card" *ngFor="let social of socialMediaHandles.controls; let i = index" [formGroupName]="i">
        <div class="content">
          <div class="field">
            <label>Platform</label>
            <select class="ui dropdown" formControlName="platform">
              <option value="">Select Platform</option>
              <option>Facebook</option>
              <option>Instagram</option>
              <option>Telegram</option>
              <option>WhatsApp</option>
              <option>Twitter/X</option>
              <option>Other</option>
            </select>
          </div>

          <div class="field">
            <label>Profile URL</label>
            <div class="ui icon input">
              <input type="url" formControlName="profile_url" placeholder="https://facebook.com/scammer-profile">
              <i class="linkify icon"></i>
            </div>
          </div>
        </div>
        <div class="extra content right aligned">
          <button type="button" class="ui red tiny button" (click)="onRemoveSocialMediaHandles(i)">
            <i class="trash icon"></i> Remove
          </button>
        </div>
      </div>
    </ng-container>


    <!-- Location   -->
    <h4>Location: Where did this happen?</h4>
    <ng-container formGroupName="location">
      <div class="two fields">
        <div class="field">
          <label for="country">Select Country</label>
          <select
            id="country"
            class="ui search dropdown"
            formControlName="country_name"
            (change)="onCountryChange($event)"  >
            <option *ngFor="let country of counties;" [value]="country.isoCode">
              {{country.name}}
            </option>
          </select>
        </div>

        <div class="field">
          <label for="cityName">Select City</label>
          <select
            id="cityName"
            class="ui search dropdown"
            formControlName="city_name"
          >
            <option [ngValue]="null">-- Select City --</option>
            <option *ngFor="let city of cities;" [ngValue]="city.name">
              {{city.name}}
            </option>
          </select>
        </div>
      </div>
    </ng-container>

    <div class="field">
      <label for="notes">Additional Note</label>
      <textarea id="notes" formControlName="notes" rows="3"></textarea>
    </div>


    <h4 class="ui dividing header">Upload Evidence</h4>
    <input type="file">

    <h4 class="ui dividing header">Optional Contact</h4>
    <div class="two fields" formGroupName="reporter">
      <div class="field">
        <label for="reporterName">Contact Name (Nick Name)</label>
        <input type="text" id="reporterName" formControlName="nick_name" placeholder=" Your Information is safe">
      </div>
      <div class="field">
        <label for="reporterMail">Contact Mail</label>
        <input type="email" id="reporterMail" formControlName="contact_mail" placeholder="e.g., johndoe@example.com">
      </div>
    </div>

    <div class="field">
      <div class="ui checkbox">
        <input type="checkbox" class="hidden">
        <label>I agree to be contacted | I agree to the Terms and Conditions</label>
      </div>
    </div>

    <div>
       <h4>Declaration & Consent</h4>
      <p>
        By submitting this report, I confirm that the information provided is true, accurate, and complete to the best of my knowledge and belief. I understand that providing false or misleading information may have legal consequences. I also give my consent for this information to be collected, stored, and used for the purpose of processing and investigating this report in accordance with applicable laws and policies."
      </p>
    </div>
    <div class="field">
      <div class="ui checkbox">
        <input type="checkbox"  class="hidden" formControlName="declarationConsent">
        <label>   I have read and agree to the Declaration & Consent.</label>
      </div>
    </div>
    <button class="ui button" type="submit" [disabled]="reportForm.invalid">Submit</button>

</form>
<ng-template #textErrorMessage let-control="control">
  <div class="ui error message" *ngIf="showErrorMessage(control)">
    <ul class="list">
      <li *ngIf="control?.errors?.['required']">
        This field is required. Please enter a value.
      </li>
      <li *ngIf="control?.errors?.['minlength']">
        Minimum {{ control?.errors?.['minlength'].requiredLength }} characters required.
      </li>
      <li *ngIf="control?.errors?.['maxlength']">
        Maximum {{ control?.errors?.['maxlength'].requiredLength }} characters allowed.
      </li>
      <li *ngIf="control?.errors?.['pattern']">
        Please enter a valid value.
      </li>
    </ul>
  </div>
</ng-template>

